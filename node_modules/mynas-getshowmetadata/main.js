var oTransform = new require('stream').Transform({ objectMode: true });
var _ = require("lodash");


var sKey = "81AB60761A073C7B";
var oTVDBApi = require("tvdb");
var oTVDB = new oTVDBApi({ apiKey: sKey });


function getShowMetadata() {

    oTransform._transform = function(oInput, encoding, done) {

        var oStream = this;

        var oModuleData = {
            show: "",
            season: "",
            episode: "",
            name: ""
        };


        var sName = oInput.name;

        var aTmp = sName.split(".");
        aTmp.pop();

        sName = aTmp.join(".");



        oTVDB.findTvShow(sName, function(err, tvShows) {

            console.log(tvShows)


            oInput["getShowMetadata"] = oModuleData;


            oStream.push(oInput);

            done();
        });


    };

    return oTransform;


}


module.exports = getShowMetadata;
